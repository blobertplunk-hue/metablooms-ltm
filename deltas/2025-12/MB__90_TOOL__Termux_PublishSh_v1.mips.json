{
  "mips": {
    "artifact_id": "MB__90_TOOL__Termux_PublishSh_v1",
    "version": "v1",
    "timestamp_utc": "2025-12-14T00:47:01Z",
    "content_type": "text/x-shellscript",
    "councils": [
      "Governance",
      "Hacker",
      "Auditor",
      "OutputForge"
    ],
    "audit": "construct",
    "links": {
      "spec_ref": "MB__SPEC__External_LTM_and_Shipping_Plan_v1.md",
      "entrypoint": "index/Memory_Index.json"
    }
  },
  "body": "#!/data/data/com.termux/files/usr/bin/bash\nset -euo pipefail\n\n# MetaBlooms Termux Publisher (one-shot)\n# Purpose: publish MB artifacts + Memory_Index.json to a static host via GitHub (recommended).\n# Model: Publisher writes → host → clients read+verify (no write-back).\n# NOTE: This script DOES NOT execute anything on remote systems; it only prepares and pushes files.\n\n########################\n# CONFIG (edit these)  #\n########################\n\n# Local git repo that you control (already \"git clone\"d in Termux)\nREPO_DIR=\"${REPO_DIR:-$HOME/metablooms_ltm}\"\n\n# Base URL where your GitHub Pages / static host serves the repo content\n# Example (GitHub Pages): https://<user>.github.io/<repo>\nHOST_BASE_URL=\"${HOST_BASE_URL:-https://HOST}\"\n\n# Where artifacts are sourced from on-device.\n# Option A: You copied the artifacts into this folder manually.\n# Option B: You download them from somewhere and place them here.\nSRC_DIR=\"${SRC_DIR:-$HOME/metablooms_publish_src}\"\n\n# DRY_RUN=1 will build files but NOT git commit/push.\nDRY_RUN=\"${DRY_RUN:-0}\"\n\n# Active set (match your Project Files contract)\nOS_FILE=\"${OS_FILE:-MB__OS__MetaBlooms_Core__ACTIVE.mips.json}\"\nCOREPACK_FILE=\"${COREPACK_FILE:-MB__01_COREPACK__GovHardening_v7__2025-12-13.mips.json}\"\nDELTA_FILES_DEFAULT=(\n  \"MB__03_DELTA__ChatGPTNativeBrowser_Synthesis_v1.mips.json\"\n  \"MB__06_RULE__ExecutionSurface_Clarification_v1.mips.json\"\n  \"MB__07_DELTA__BootHeader_LintAndRewrite_v1.mips.json\"\n)\n\n# You can override DELTA_FILES by exporting it as a space-separated list:\n#   export DELTA_FILES=\"file1 file2 file3\"\nDELTA_FILES=()\nif [[ -n \"${DELTA_FILES:-}\" ]]; then\n  # shellcheck disable=SC2206\n  DELTA_FILES=(${DELTA_FILES})\nelse\n  DELTA_FILES=(\"${DELTA_FILES_DEFAULT[@]}\")\nfi\n\n########################\n# Helpers              #\n########################\n\nneed() {\n  command -v \"$1\" >/dev/null 2>&1 || {\n    echo \"[FAIL] Missing dependency: $1\"\n    echo \"Install: pkg install -y git jq openssl\"\n    exit 1\n  }\n}\n\nsha256_of() {\n  # prints raw hex\n  openssl dgst -sha256 \"$1\" | awk '{print $2}'\n}\n\nensure_dirs() {\n  mkdir -p \"$REPO_DIR/index\" \"$REPO_DIR/artifacts\" \"$REPO_DIR/deltas\"\n  mkdir -p \"$SRC_DIR\"\n}\n\ncopy_or_fail() {\n  local src=\"$1\"\n  local dst=\"$2\"\n  if [[ ! -f \"$SRC_DIR/$src\" ]]; then\n    echo \"[FAIL] Source missing: $SRC_DIR/$src\"\n    echo \"Put the file there first (copy/download).\"\n    exit 1\n  fi\n  cp -f \"$SRC_DIR/$src\" \"$dst\"\n}\n\n########################\n# Main                 #\n########################\n\nneed git\nneed jq\nneed openssl\n\nensure_dirs\n\nif [[ ! -d \"$REPO_DIR/.git\" ]]; then\n  echo \"[FAIL] REPO_DIR is not a git repo: $REPO_DIR\"\n  echo \"Fix: git clone <your_repo_url> \"$REPO_DIR\"\"\n  exit 1\nfi\n\necho \"[OK] Using repo: $REPO_DIR\"\necho \"[OK] Using source: $SRC_DIR\"\necho \"[OK] Host base: $HOST_BASE_URL\"\n\n# Copy active artifacts into canonical host layout\ncopy_or_fail \"$OS_FILE\"       \"$REPO_DIR/artifacts/$OS_FILE\"\ncopy_or_fail \"$COREPACK_FILE\" \"$REPO_DIR/artifacts/$COREPACK_FILE\"\n\nfor f in \"${DELTA_FILES[@]}\"; do\n  copy_or_fail \"$f\" \"$REPO_DIR/deltas/$f\"\ndone\n\n# Compute hashes\nOS_SHA=\"$(sha256_of \"$REPO_DIR/artifacts/$OS_FILE\")\"\nCORE_SHA=\"$(sha256_of \"$REPO_DIR/artifacts/$COREPACK_FILE\")\"\n\n# Build delta queue objects\nDELTA_QUEUE_JSON=\"$(jq -n '[]')\"\nfor f in \"${DELTA_FILES[@]}\"; do\n  sh=\"$(sha256_of \"$REPO_DIR/deltas/$f\")\"\n  DELTA_QUEUE_JSON=\"$(jq -c --arg url \"$HOST_BASE_URL/deltas/$f\" --arg sha \"$sh\" '. + [{url:$url, sha256:$sha}]' <<<\"$DELTA_QUEUE_JSON\")\"\ndone\n\n# Write Memory_Index.json (single mutable entrypoint)\nINDEX_JSON=\"$(jq -n   --arg version \"$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\"   --arg os_url \"$HOST_BASE_URL/artifacts/$OS_FILE\"   --arg os_sha \"$OS_SHA\"   --arg core_url \"$HOST_BASE_URL/artifacts/$COREPACK_FILE\"   --arg core_sha \"$CORE_SHA\"   --argjson dq \"$DELTA_QUEUE_JSON\"   '{version:$version, active:{os:{url:$os_url, sha256:$os_sha}, corepack:{url:$core_url, sha256:$core_sha}}, delta_queue:$dq}' )\"\n\necho \"$INDEX_JSON\" | jq '.' > \"$REPO_DIR/index/Memory_Index.json\"\n\necho \"[OK] Built index/Memory_Index.json\"\necho \"     OS sha256: $OS_SHA\"\necho \" Core sha256: $CORE_SHA\"\necho \"   Deltas (#): ${#DELTA_FILES[@]}\"\n\ncd \"$REPO_DIR\"\ngit add -A\n\nif [[ \"$DRY_RUN\" == \"1\" ]]; then\n  echo \"[OK] DRY_RUN=1 — not committing/pushing.\"\n  exit 0\nfi\n\nMSG=\"Publish MetaBlooms LTM index + artifacts ($(date -u +\"%Y-%m-%dT%H:%M:%SZ\"))\"\ngit commit -m \"$MSG\" || echo \"[OK] No changes to commit.\"\ngit push\n\necho \"[OK] Published.\"\necho \"[OK] Entry point: $HOST_BASE_URL/index/Memory_Index.json\"\n\n# Quick fetch test (optional; requires curl)\nif command -v curl >/dev/null 2>&1; then\n  echo \"[OK] Smoke test: fetching index...\"\n  curl -fsSL \"$HOST_BASE_URL/index/Memory_Index.json\" | jq '.' >/dev/null\n  echo \"[OK] Fetch+parse passed.\"\nelse\n  echo \"[WARN] curl not installed; skip smoke test. Install: pkg install -y curl\"\nfi\n"
}